<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.situ.jingbao.dao.ListDao">
    <resultMap id="ListMap" type="Goods">
        <id column="goods_id" property="goodsId"/>
        <result column="goods_name" property="goodsName"/>
        <result column="goods_hover_img" property="goodsHoverImg"/>
        <result column="goods_first_img" property="goodsFirstImg"/>
        <result column="goods_discount" property="goodsDiscount"/>
        <result column="goods_price" property="goodsPrice"/>
        <result column="goods_level" property="goodsLevel"/>
        <result column="goods_new" property="goodsNew"/>
        <result column="new_goods_price" property="newGoodsPrice"/>
    </resultMap>
    <select id="findGoods" resultMap="ListMap" parameterType="GoodsCondition">
        SELECT goods_id, goods_name,new_goods_price, goods_hover_img,goods_first_img,goods_discount,goods_price,goods_level,goods_new
        from t_goods
        <where>
            <if test="gc.goodsId!=null">
                and goods_id = #{gc.goodsId}
            </if>
            <if test="gc.goodsName!=null and gc.goodsName!=''">
                <bind name="goodsName" value="'%'+gc.goodsName+'%'"/>
                and goods_name like #{goodsName}
            </if>
            <if test="gc.priceFilterEnd!=null">
                and new_goods_price &lt; #{gc.priceFilterEnd}
            </if>
            <if test="gc.priceFilterStart!=null">
                and new_goods_price &gt; #{gc.priceFilterStart}
            </if>
            <if test="gc.goodsLevel!=null">
                and goods_level &gt; #{gc.goodsLevel}
            </if>
            <if test="gc.goodsNew!=null">
                and goods_new = #{gc.goodsNew}
            </if>
            <if test="gc.titleIds!=null">
                and category_id in
                <foreach item="titleId" collection="gc.titleIds" open="(" separator="," close=")">
                    #{titleId}
                </foreach>
            </if>
        </where>
    </select>
    <resultMap id="GoodsIdMap" type="Goods">
        <id column="goods_id" property="goodsId"/>
        <result column="goods_name" property="goodsName"/>
        <result column="goods_hover_img" property="goodsHoverImg"/>
        <result column="goods_first_img" property="goodsFirstImg"/>
        <result column="goods_discount" property="goodsDiscount"/>
        <result column="goods_price" property="goodsPrice"/>
        <result column="goods_level" property="goodsLevel"/>
        <result column="goods_new" property="goodsNew"/>
        <result column="goods_introduce" property="goodsIntroduce"/>
        <result column="new_goods_price" property="newGoodsPrice"/>
        <collection property="goodsImgs" column="goods_id" select="getGoodsIdImg"/>
    </resultMap>
    <select id="getGoodsId" resultMap="GoodsIdMap" parameterType="java.lang.Integer">
        SELECT goods_id, goods_name,new_goods_price,
        goods_hover_img,goods_first_img,goods_discount,goods_price,goods_level,goods_new,goods_introduce
        from t_goods
        <where>and goods_id=#{goodsId}</where>
    </select>

    <select id="getGoodsIdImg" resultType="java.lang.String" parameterType="java.lang.Integer">
        SELECT img_src
        from t_goods_img
        <where>and goods_id=#{goodsId}</where>
    </select>

    <select id="findId" resultType="java.lang.Integer" parameterType="java.lang.String">
        SELECT title_id
        from t_title
        where title_name = #{categoryName}
    </select>
</mapper>
